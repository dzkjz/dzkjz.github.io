<html>

<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>
    JojoLegend
</title>
<link rel="shortcut icon" href="https://dzkjz.github.io//favicon.ico?v=1596552801325">
<!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> -->
<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://dzkjz.github.io//styles/main.css">
<!-- js -->
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://dzkjz.github.io//media/js/jquery.sticky-sidebar.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


</head>

<body>
    <div class="main">
        <div class="header">
    <div class="nav">
        <div class="logo">
            <a href="https://dzkjz.github.io/">
                <img class="avatar" src="https://dzkjz.github.io//images/avatar.png?v=1596552801325" alt="">
            </a>
            <div class="site-title">
                <h1>
                    JojoLegend
                </h1>
            </div>
        </div>
        <span class="menu-btn fa fa-align-justify"></span>
        <div class="menu-container">
            <ul>
                
                    
                            <li>
                                <a href="/" class="menu">
                                    首页
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/archives" class="menu">
                                    归档
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/tags" class="menu">
                                    标签
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/post/about" class="menu">
                                    关于
                                </a>
                            </li>
                            
                                
            </ul>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        $(".menu-btn").click(function() {
            $(".menu-container").slideToggle();
        });
        $(window).resize(function() {

            if (window.matchMedia('(min-width: 960px)').matches) {
                $(".menu-container").css('display', 'block')
            } else {
                $(".menu-container").css('display', 'none')
            }

        });
    });
</script>

            <div id="main-content" class="post-container main-container">
                <div id="content" class="main-container-left">
                    
        
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://dzkjz.github.io/post/zen-me-gu-suan-yi-ge-wang-zhan-de-shou-ru/">
                        怎么估算一个网站的收入？
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-08-04</time>
                    
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            这个可以直接去 flippa
或者 empireflippers
或者 FE International 这种网站交易平台，
看卖的网站价格，出售方会注明当前月收益还有流量数据：
比如这个网站

然后
流量数据可以去SimiliarWeb搜：

当然有人会虚报，不过看的数据越多，也就越来越有数。
这些网站的卖价倍数一般成交都在26-40之间。net profit*(26~40)=final price

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://dzkjz.github.io/post/zen-me-gu-suan-yi-ge-wang-zhan-de-shou-ru/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://dzkjz.github.io/post/2019-nian-qing-mai-seo-da-hui-bi-ji-day-1zhai-chao/">
                        2019年清迈SEO大会笔记（Day 1）摘抄
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-08-04</time>
                    
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            就是谈了个SurferSEO，以及这个观点：

但是我比较在意的是这段话：

怎么做到的呢？他首先分析了这个词排名前三的竞争页面，总结出一些特征，比如：关键词出现在哪里？重复次数多少？语义相关的词有哪些？几张图片？字数多少等等。


                                        </div>
                                        
                                            <a class="btn btn-text" href="https://dzkjz.github.io/post/2019-nian-qing-mai-seo-da-hui-bi-ji-day-1zhai-chao/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://dzkjz.github.io/post/my-15-all-time-best-seo-tips-that-get-results/">
                        My 15 All-Time BEST SEO Tips (That Get Results)
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-08-04</time>
                    
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            视频发布时间是2018年，源地址 https://www.youtube.com/watch?v=P_hPlUpLD54 作者官网 https://backlinko.com/
Use Short URL&#39;s
说的是博主自己统计后，发现短链接rank better
Use Amazon for keyword ideas
find pop book on amazon in your niche
checkout toc of that book, 这些标题小标题就是关键词呗
然后去你常用的keyword 软件或者网站 搜这些关键词的volume大小，然后就是老路子，收集关键词。
Optimize your title tag for CTR
CTR 利于 seo 就是整点能增加CTR的标题标签啥的，道理我都懂，做起来哪有那么多时间和心思。顾不过来啊。
Publish content at-least 1890 words
Use title tag modifiers
标题标签里加[2020] &amp;quot;Best&amp;quot; &amp;quot;Review&amp;quot; &#39;Free Shipping&#39; &amp;quot;Checklist&amp;quot;这些词。
最后标题就这模式：

然后你的关键词就可以match这么多：

Use Keyword-Rich URL&#39;s

Use numbers in your title tag

根据研究结果，标题里带数字CTR更高：这尼玛很容易变化的，有时候带表情也很高，有时候素一点更高。

Use two-step EMAIL outreach
Broken Link-Building
check my links 这招
邮件模板：

等回复，然后

等回复，然后

Choose keyword with strong commercial intend
Delete Under performing Pages
删掉多余的没啥用的页面，转换不高，没人气的就删了。
Optimize your videos around &amp;quot;Video Keywords&amp;quot;
Use Reddit for Keyword Research
Link out to Authority website
Hack Wikipedia for keyword research

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://dzkjz.github.io/post/my-15-all-time-best-seo-tips-that-get-results/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://dzkjz.github.io/post/seo-tutorial-for-beginners-step-by-step-guide-2020-yoast-seo/">
                         SEO Tutorial for Beginners - Step by Step Guide 2020! (+YOAST SEO)
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-08-04</time>
                    
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            此类课程就是废话多，概念一堆，实操0。看了就是避免以后再去绕这些文字游戏。
教程地址：https://www.youtube.com/watch?v=f_n0_cxWqSs
How Does Google Rank Websites?

扫描你的站点入库，用户搜索的是否与你站点内的内容有关联。这个一般就是搞点关键词，文章里尽量做点关键词，但不要超过2个或3个。


用户搜的关键词你的文章里有，那就有机会了。做关键词就是标题,URL，文章，meta，图片alt之类的里面搞。尽量搞一些还可以做的动的词，有的你排名怎么都做不到前10的牛词，做了也是白给。



外链数量。就是其他网站提到你的网站，很重要，类似于被人提点，越多重要人物【网站】提到你【的站】，说明你的站越牛。被动技能，除非买外链。


点击率，这个就是搜索结果页面里，点你的概率，这尼玛玄学，用户一般点击是结果第1个 40% 第2名 20% 第3名 10% 然后第一页一般占了90%，那等于说，越靠前的就越来越高的点击率了。就是个被动技能。


停留时长，文章就是有点价值的，这个一般就是比较主观了，反正别水文章就行，要水也可以，可以多加点什么，想学这个，点这里，点那里，都是站内链接，用户看了不舍得关，一时半会儿又看不完，或者给你收藏了。


网站打开速度，越快越好。网站卡了用户体验性不好，搜索引擎也认为你的站不太OK。一般就是资源少点，css，js文件精简优化，图片不要太大。


对移动设备友好，基本上就是搞点AMP啊自适应之类的。


网站有价值，用户喜欢，这东西很主观的，评判标准就是shit。


Types of Search Queries 搜索动机类型

查资料 how to/review/definitions/news...
找位置 netflix/ebay... 就是用户记不住完整url，搜一下名字，点一下就去官网了。 这种词一般用户就是直接谷歌然后到官网去的，没啥搞头。特别是那种大网站的词。
买东西 bmw x6/ticket/dell/iphone air pods...

Finding Profitable Keywords 怎么找可以赚钱的关键词
Local



找你可能需要的关键词，比如你是做地毯清洁业务的，那就是哪里哪里，啥地毯清洁，然后去搜同行看他们的关键词，这样就有点思路了，用Notepad记录一下这些词；


Ubersuggest 搜一搜
找找思路，关键词，然后记录到notepad上。
不要搞太多，太多了思路不清晰。


​    关键词，页面思路图
就是Title，URL，H1，Meta，Head之类，以及文章里面搞关键词，如主关键词是3个字的关键词，那么文章里面还可以搞些的短一点的2个，3个长度的，差不多意思的词。这个是原理，一般用网上的那种页面分析工具，会给你指出来。
如：
不过这种方式，会找出一些很无关的，不过看得多了就知道是哪些词了，有的还带关键词在搜索引擎的排名数据【Ubersuggest可以】，就可以明显看出来了。
MozBar的chrome插件可以看PA DA，看搜索结果前10的同行数据，用于分析做好这个关键词要的时间，
这种可能需要一周就出结果【前10】
这种可能需要几个月【前10】
这种新手就不要想多了，要得久，且竞争激烈：
这种词【how to】比较容易做，文章也好写，也有关联性，并且，这类how to之类的文章写出来，有阅读价值，也容易获得自然外链。
如果看到有，流量也不错1000左右，那可以挑出来做。

当然有钱的可以搞一个Semrush：
 直接搜一下同行的网站就出结果，相当省事。

这么多结果，一般就是挑一些有流量，KD【keyword difficulty】关键词难度不那么高的可以收集起来，分析后，可以做这些关键词。
还可以看Backlinks
还挺有用的，这第一个就是一个本地列表站，免费注册的，那么就可以自己也注册一个，发布上去，那就有一个免费高质量的外链了。可以多看看人家的外链，可以免费搞的那就给加上！


Blog/Personal
如果打算做Blog，可以有这几个方向【主要是以收入profit为导向】：

每个方向，都有很多例子，谷歌搜一搜，给你一大堆。
这里以做一个旅游博客为例。

每一个关键词都可以用ubersuggest看看浏览量大小，以及其他相关的关键词，CPC信息等。
当然有些词，Ubersuggest还是看不到数量，那么就只有用adwords的keyword planner了：

以下是基本操作步骤：

选择一个主关键词：这里是Things to do in Bali
选择一个副关键词：这里是Things to do in Bali Indonesia
用主关键词在Ubersuggest上搜一下，选择地区us，web，
根据流量volume排序，选择几个与主关键词有一定联系【就是写文章的时候可能写得进去的】的联系关键词，这里选择了：

然后文章就是H1 Title URL meta用主词；第一段，第一行有主词副词；文章其他部分要有选择的联系关键词；联系关键词可以有5个-8个。
eCommerce

用到个画板 awwapp.com

这里用的例子是 iPhone accessories 苹果配件
一般是你做啥商品就想啥初始词。
这里就是举了几个手机配件的名字。

实在想不出，就去看同行搞的啥。
初始词想好就可以去Ubersuggest搜集一下推荐的关联词了


为什么不去adwords的keyword panner?因为要登陆，还要adwords，挺麻烦的，当然更准确的。

如果大部分词都是1000以下的：

那多整几个有关联的词，好出文章的，组成一组就行了。


另外，重视一下这种best，top，how之类的词

因为一般来说，自然外链不会主动直接链接到你的商品上去，但是你写的best，howto教程之类的文章，就很容易获得自然外链。然后你再在这种文章里点一些你的商品，就可能有转化了。但最主要是用于获得外链的。

还有就是直接谷歌搜一下，出来的结果中，看看同行怎么做的，有哪些商品，哪些词。SEO规划如何，这样知己知彼，还可以查漏补缺，取其精华。
最好是记录一下同行的竞争页面URL，然后拿到Semrush里再去分析一下。主要是看有哪些带来流量的keyword：

可以收集些好的关键词【带量大的】，以及关键词页面的具体信息，可以学习。
然后拿去KWFinder搜搜，看看Keyword SEO Difficulty关键词上SEO的难度：
这里是37，还比较容易，那就可以把这个词做主关键词了【可以用到商品分类名及标题上面或者url，h1啊】。
然后下面的suggestions可以看看挑几个做副关键词。
然后可以再用Ubersuggestion搜搜你的主关键词，看看其他词，有的就可以做具体商品类了。

然后再用这些词去谷歌看看同行的站点，还可以去KWFinder看看难度。太难的新手可能就只能放弃了。
然后又去Ubersuggestion搜这两个关键词，挑个相关的做副词。

差不多了。整个找关键词的流程就这样：
初始词-&amp;gt;推荐词-&amp;gt;同行-&amp;gt;KW/Uber/Keyword Planner/Semrush 分类主词/副词/具体页面主词/副词。

On-Page Seo怎么做？
这老师是用的wp做讲解，安装了yoast插件。然后就是一顿微操，这个可以看看。平时没怎么注意有的设置还挺有用的。

Local:
文章内设置SEO:

标题中：
主关键词尽量靠前，实在不好组织语句就往后逐步顺延，但能靠多前靠多前。“ | ”后面的语句要做到：简洁明了，与众不同最好，要能激励用户点击进来。
meta description
有近似关键词的就行，这里虽然就是主关键词，一般近似都可以的，而且不要太长太大段的内容，这个内容会显示在这个位置：

然后输入Focus keyword：

这样插件就可以帮你分析了。分析结果不需要全绿，尽量多就行。
然后URL：
wp中一般设置URL就是post name就行。
接下来就是H1标题做SEO：
标准和标题里的差不多的，就是主关键词尽量靠前，实在不好组织语句就往后逐步顺延，但能靠多前靠多前。
然后段落文本中：
需要副关键词、关联关键词，这老师是用的：

出现位置：


因为用户搜索的时候，可能不会直接搜主关键词，搜的其他关键词如果在你文本中的关联关键词，副关键词，那就也有机会出现在搜索结果前面。
但要注意，关键词不要乱堆砌，要自然通顺。
这个是规则，但一般操作就是先写一段话，然后改，想办法加这些关键词进去。
图片:
页面里面的图片名字，alt文本可以设置成关键词【主，副都可以】
补充：
然后就是加testimonial：

加call us section ：

footer里面加联系方式【每一页就都可以找到联系方式了】：

分流：

就是在主页的slider下面记得加个这个section，可以跳转到其他分类页面，这样主页的流量不会浪费：


如果用户看到且用户觉得还OK，那他会点开稍后查看，


而且一般在本地列表站，都是录入自己网站的主页，这样外链的权重可以分出一部分到这几个子页面。


还需要注意的就是，不需要做成100%SEO优化的，有个7成就行了。
Blog/Personal:
标题举例：
就是说:
标题里面有关键词，但是也要有可读性；
URL的slug可以和标题的不一致；
第一段要有主关键词；
Meta 也要有关键词；
内链；
实在想不出可以搞个Read More...., Related...., Recommend....
指向外部的链接；
图片；
其余的可以以后参考同行的做。
eCommerce:
标题, URL, H1, Meta, 图片[name, alt], 段落文本....
Offpage SEO
基本上就是怎么做外链。


谷歌搜出同行


Semrush查同行的backlinks：最好anchor text是你的主关键词，但不强求，数据自然一点


同行外链来源如果找到有local listing或黄页站，那自己可以注册的，就注册然后自己添外链


如果看到同行的外链中有评论链接，或者下面这种链接，那也可以自己手动做外链：


还可以在大学啊啥的发coupon链接。不过要注意：


还有就是看博客，给人家交换价值，或者直接contact站长，付费做guest post之类的。不过要确保目标站和自己的站点有关联性，而且站点内容有活跃。


神奇小妙招：

以旅游类博客为例

安装一个插件，chrome extesion 搜 check my links.效果如下：
看到这种invalid links，可以看看站点主题内容是否与我们的站点相关，如果是，那么可以向站长联系，你的这个链接掉了【是那种他链接过去的站点网站没做了，生意不做了之类的】，但是内容我和他的差不多，可以链接我不，因为你的内容如果也不错，对于他的文章也是有益处的，不用谈及付费。
比如：这个地方就是掉了，这段话就是给他文章的读者推荐了一家讲解visa资料的站，但是这个站挂了，那你要是有一个站，有这方面的内容，或者写好了这方面的内容，在忙外链，那就正好可以咨询一下这个站长。


Analysis：跟踪分析自己的SEO成绩，如何提高
用Semrush：

然后就是一路按照导航微操。
Google analytics


然后按照导航一路微操
如果是WP，可以安装
小设置：

效果：

当然更详细的数据还是在google 自己的dashboard看啦。
Keyword
其他推荐
Neil patel
Smart Blogger
Stackpath CDN加速服务。贵得很。

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://dzkjz.github.io/post/seo-tutorial-for-beginners-step-by-step-guide-2020-yoast-seo/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://dzkjz.github.io/post/seo-zhi-keyword-research/">
                        SEO 之 Keyword research
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-08-02</time>
                    
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            What is SEO[search engine optimization]
What is SEO and How Does it Work? (2020)
1.40%
2.20%
3.10%
few than 10% will goto next page
relavant
people also ask
On-Page SEO
controllable
是可以在写完文章后做的调整。写的时候也可以。

标题中有你要的主题keyword，越靠前越好。
url中也要有。url尽量短一点，主题鲜明一点。
第一段文本甚至于第一段的第一句，要有keyword。
内链，为了提高在站时长。google也会据此加分。甚至就是简单的，【建议阅读+链接】的格式。
副标题，子标题可以尽量有keyword。或者关联keyword的助力keyword。
避免长文本段落，可以加图片增加一点空间。图片 alt文本【描述图片用】，图片title。
meta description 一般就是



但是不要超过160个字符。


可以加几个出站链接。

Backlinks
Keyword Research
关键词动机
品牌 amazon netflix...
商品型号 cannon 5d, Tesla Model S...
资料信息 what how ...
查询 best top coupon deals cheap budget affordable free...
方法

注意，主要是用于博客类的网站

头脑风暴
应该自己想一个topic，没人比你更清楚你要做的是什么。从这个start point出发，联想一些词，但是由于长期关注到的是这几个主题词，并不一定能清楚知道，用户平时搜索的词具体是什么，更多的是什么，比例如何，关联度如何，所以需要下面的工具。
工具
keywords everywhere

related keywords

answerthepublic

Semrush 付费版

Ahrefs
How to Use Ahrefs for Keyword Research 视频很罗嗦，主题就是一个很简单的Ahref说明书。
这里还推荐了一个工具： Ubersuggest
Google Trends
介绍基本用法，其实很简单，就是输入搜索词，然后结果分析一下。How To Use Google Trends! Market Research To Compare Keywords, Topics &amp;amp; Niches, Fast!，其他的都是废话。
KWFinder
SEO Tutorial for Beginners - Step by Step Guide 2020! (+YOAST SEO)
Keyword

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://dzkjz.github.io/post/seo-zhi-keyword-research/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://dzkjz.github.io/post/xiang-google-ti-jiao-zhan-dian-qing-qiu-shou-lu/">
                         向google提交站点【请求收录】
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-07-31</time>
                    
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            登录地址 https://search.google.com/
需要验证域名所有权
参考 How to Ask Google to Recrawl URLs of Your WordPress Site
或 How to Ask Google to Recrawl URLs of Your WordPress Site
提交页面 index请求

现在搜索框中输入页面地址，回车，看是不是页面被索引了，如果需要索引 点REQUEST INDEXING即可。
提交sitemap

一般来说，一个小时到一天就收录了。

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://dzkjz.github.io/post/xiang-google-ti-jiao-zhan-dian-qing-qiu-shou-lu/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://dzkjz.github.io/post/laravel-shi-yong-sendgrid-de-pei-zhi/">
                        laravel使用sendgrid的配置
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-07-31</time>
                    
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            petapi-app的.env文件需要修改：
將QUEUE_CONNECTION=sync改爲：
QUEUE_CONNECTION=database


這樣才能使用queue job，之前不改就一直给👴报500错误：

而且参考使用 https://github.com/s-ichikawa/laravel-sendgrid-driver
之后 sendgrid 配置就很简单了：

.env
MAIL_DRIVER=sendgrid
SENDGRID_API_KEY=&#39;YOUR_SENDGRID_API_KEY&#39;

config/services.php (In using lumen, require creating config directory and file.)
&#39;sendgrid&#39; =&amp;gt; [
  &#39;api_key&#39; =&amp;gt; env(&#39;SENDGRID_API_KEY&#39;),
],

config/mail.php
&#39;mailers&#39; =&amp;gt; [
  &#39;sendgrid&#39; =&amp;gt; [
      &#39;transport&#39; =&amp;gt; &#39;sendgrid&#39;,
  ],
],


用了之后报550错误
官方文档写




550
Requested action not taken: mailbox unavailable
The user’s mailbox was unavailable. Usually because it could not be found, or because of incoming policy reasons. Remove these address from your list - it is likely a fake, or it was mistyped.











所以又换成了原来的默认配置，并且参考 https://sendgrid.com/docs/for-developers/sending-email/laravel/ 配置了.env，然后就ok了 port是用的587+ tls没有用ssl+465

另外参考 https://laravel.io/forum/why-queue-still-waiting-when-send-mail-in-laravel 可以在app容器内执行
composer dumpautoload


还要注意，之前使用的queue容器，因为默认是root用户 无法执行artisan命令 所以这个容器就用不上了。
于是又改成了在docker容器里加supervisord：

不过在使用supervisord前多说几句，
平时执行的 php artisan queue:work一旦关闭terminal，就会中止，所以需要介绍一个nohup命令，此命令可以忽略terminal中止，nohup-运行不受挂断影响的命令，并采用非tty输出 ，那么参考https://stackoverflow.com/a/28625847 即可执行：
nohup php artisan queue:work --daemon &amp;amp;
或者执行下面命令把log输出到文件中
nohup php artisan queue:work --daemon &amp;gt; app/storage/logs/laravel.log &amp;amp;

开始讲解如何使用supervisord:
官方讲解
补充讲解
Installing Supervisor to Manage Laravel Queue Processes on Ubuntu
执行sudo apt install supervisor 这个安装由于可以在dockerfile中完成所以直接加到了app服务的Dockerfile中。
FROM php:7.2.19-fpm

# Arguments defined in docker-compose.yml
ARG user
ARG uid

# Install system dependencies
RUN apt-get update &amp;amp;&amp;amp; apt-get install -y \
    git \
    curl \
    libpng-dev \
    libonig-dev \
    libxml2-dev \
    zip \
    unzip \
	supervisor


# Clear cache
RUN apt-get clean &amp;amp;&amp;amp; rm -rf /var/lib/apt/lists/*

# Install PHP extensions
RUN docker-php-ext-install pdo_mysql mbstring exif pcntl bcmath gd

# Get latest Composer
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

# Create system user to run Composer and Artisan Commands
RUN useradd -G www-data,root -u $uid -d /home/$user $user
RUN mkdir -p /home/$user/.composer &amp;amp;&amp;amp; \
    chown -R $user:$user /home/$user

# Set working directory
WORKDIR /var/www

USER $user


然后是Supervisor配置文件，默认情况这个配置文件需要放在/etc/supervisor/conf.d文件夹下面，此文件夹下，可以创建无数你需要的配置文件，反正需要supervisor监视的就给到这里面，那这个文件夹在docker-compose.prod.yml里面直接用volume挂载好就行了，我这里是
version: &amp;quot;3.7&amp;quot;
services:
  app:
    build:
      args:
        user: petapi
        uid: 1000
      context: ./
      dockerfile: Dockerfile
    image: petapii
    container_name: petapi-app
    restart: unless-stopped
    working_dir: /var/www/
    volumes:
      - ./:/var/www
      - ./docker-compose/supervisor:/etc/supervisor/conf.d
    networks:
      - petapin

挂的这个文件夹
- ./docker-compose/supervisor:/etc/supervisor/conf.d
然后再在 宿主机 上下文 ./docker-compose/supervisor路径创建名为petapi-worker.conf的文件，容器启动后，容器内就挂得有一个/etc/supervisor/conf.d/petapi-worker.conf文件了。
编辑文件如下：
[program:petapi-worker]
process_name=%(program_name)s_%(process_num)02d
command=sudo php /var/www/artisan queue:work --tries=3 --sleep=3 --daemon
user=petapi
autostart=true
autorestart=true
numprocs=1
redirect_stderr=true
stopwaitsecs=3600
stdout_logfile=/var/www/storage/logs/petapi-worker-supervisor.log

我的petapi挂载在/var/www下面，artisan命令执行也在改文件夹路径，所以command为command=sudo php /var/www/artisan queue:work

也可以使用conf再执行脚本的方式，参考 https://gist.github.com/danharper/9136507


由于需要给supervisor执行php artisan命令的权限，所以用户设置为了petapi，有的如：How to use Laravel Queue Worker with Supervisor  及Installing Supervisor to Manage Laravel Queue Processes on Ubuntu给了用户组supervisor然后给这个用户组添加执行artisan命令的权限，这里我们不需要的。

然后服务容器启动就执行
sudo supervisorctl reread

sudo supervisorctl update

sudo supervisorctl start petapi-worker:*

直接写到supervisor_petapi.sh脚本里面，文件在./docker-compose/supervisor宿主机文件夹内
supervisorctl reread

supervisorctl update

supervisorctl start petapi-worker:*

然后Dockerfile添加：
COPY --chown=$user ./docker-compose/supervisor/supervisor_petapi.sh /var/www

...
USER $user
...
CMD supervisor_petapi.sh                  

有异常:

  supervisorctl reread

error: &amp;lt;class &#39;socket.error&#39;&amp;gt;, [Errno 2] No such file or directory: file: /usr/lib/python2.7/socket.py line: 228

这样app容器启动的时候就会执行上述脚本命令了。
还是没成功，明天继续！
发现执行
docker exec -it petapi-app bash进入容器后，用户由于在Dockerfile中被指定为了petapi，执行apt-get会提示没有权限，所以参考Root password inside a Docker container执行docker exec -u 0 -it petapi-app bash以root身份登录进入即可
执行supervisorctl reread
报错unix:///var/run/supervisor.sock no such file，参考Supervisor sock file missing执行
service supervisor stop
service supervisor start 

执行supervisorctl reread有报错： 这不是错；

参考Supervisord config changes not recognized after reread/update 是指，没有更新，所以没有显示有变化。
然后执行supervisorctl update
以及supervisorctl start petapi-worker:*

这次是报错了。找不到文件。
如果是报这个错laravel-worker: ERROR (no such group)，可以看看
/etc/supervisord.conf文件配置的
[include]
files = supervisord.d/*.conf

这个include部分是不是指向的worker配置路径，我这里是


由于debug需要ps命令，所以参考ps command doesn&#39;t work in docker container,执行RUN apt-get update &amp;amp;&amp;amp; apt-get install -y procps添加之

执行ps -ef | grep supervisor查看

但是执行service supervisor stop后依然有一个

索性直接执行kill -s SIGTERM 468关闭这个468进程。
然后执行service supervisor start启动后查看：

下面解释一下
/usr/bin/supervisord -c /etc/supervisor/supervisord.conf，

参考Creating a Configuration File，如果执行用户没有root权限或者supervisord.conf文件没有放在默认的/etc/supervisord.conf路径，那么-c后面接你实际防止supervisord.conf文件的路径。默认情况下，supervisor会在其当前路径里面找这个conf文件，加 -c 就可以指定其他位置了。

但是执行supervisorctl start petapi-worker:*

这次是依然报错了。找不到文件。直接nano编辑这个文件然后

终于给👴OK了。
然后执行supervisorctl status查看一下状态：

行吧。
再改一下。
先执行supervisorctl stop all

及执行service supervisor stop停掉进程。
再执行supervisorctl status查看状态：

再执行ps -ef | grep supervisor查看进程停止完没有：

OK，停止完了，我们改改这个petapi-worker.conf文件：
去掉sudo后：

然后执行service supervisor start及
supervisorctl reread

supervisorctl update

supervisorctl start petapi-worker:*

然后执行supervisorctl status查看状态

OK了。
总结
petapi-worker.conf文件：
[program:petapi-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/artisan queue:work --tries=3 --sleep=3 --daemon
user=petapi
autostart=true
autorestart=true
numprocs=1
redirect_stderr=true
;stopwaitsecs=3600
stdout_logfile=/var/www/storage/logs/petapi-worker-supervisor.log

app容器的Dockerfile文件：
FROM php:7.2.19-fpm

# Arguments defined in docker-compose.yml
ARG user
ARG uid

# Install system dependencies
RUN apt-get update &amp;amp;&amp;amp; apt-get install -y \
    git \
    curl \
    libpng-dev \
    libonig-dev \
    libxml2-dev \
    zip \
    unzip \
	supervisor


# Clear cache
RUN apt-get clean &amp;amp;&amp;amp; rm -rf /var/lib/apt/lists/*

# Install PHP extensions
RUN docker-php-ext-install pdo_mysql mbstring exif pcntl bcmath gd

# Get latest Composer
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

# Create system user to run Composer and Artisan Commands
RUN useradd -G www-data,root -u $uid -d /home/$user $user
RUN mkdir -p /home/$user/.composer &amp;amp;&amp;amp; \
    chown -R $user:$user /home/$user

# Set working directory
WORKDIR /var/www

USER $user

考虑给一个supervisor容器。

因为supervisorctl命令执行需要root用户，petapi用户不行。

之前在Dockerfile中添加
COPY --chown=$user  ./docker-compose/supervisor/supervisor_petapi.sh . 
...
USER $user
...
CMD /var/www/supervisor_petapi.sh
...

的方式不可行，因为sh脚本里面的命令执行必须是root权限，而切换成USER petapi后就无法执行sh脚本里面的supervisorctl命令了。
另外也不能将CMD删除换成在USER切换前的RUN命令，因为虽然用户权限有了，但是容器没有启动，sh脚本里面的conf文件执行artisan命令必然失败。
所以考虑给一个supervisor容器。
最方便的方式：
也是最合适的方式，这样一个容器只负责一件事。
docker-compose.prod.yml采用php-queue服务，其服务容器的镜像就是这个petapi-app的镜像，而用户不给参数，则直接使用petapi-app中就设置好的petapi用户，然后command就是command: [&amp;quot;php&amp;quot;, &amp;quot;/var/www/app/artisan&amp;quot;, &amp;quot;queue:work&amp;quot;, &amp;quot;--daemon&amp;quot;, &amp;quot;--sleep=3&amp;quot;, &amp;quot;--tries=3&amp;quot;]
这样supervisor都不用。
不过 同时我们还需要执行一个composer dumpautoload命令，参考Using Docker-Compose, how to execute multiple commands所以：
command: &amp;gt;
	bash -c &amp;quot;php artisan queue:work --sleep=3 --tries=3 &amp;amp;&amp;amp;
	composer dumpautoload&amp;quot;

如果没有安装bash的，请使用sh -c
docker-composer.prod.yml
version: &amp;quot;3.7&amp;quot;
services:
  app:
    build:
      args:
        user: petapi
        uid: 1000
      context: ./
      dockerfile: Dockerfile
    image: petapii
    container_name: petapi-app
    restart: unless-stopped
    working_dir: /var/www/
    volumes:
      - ./:/var/www
    networks:
      - petapin
  php-queue:
    restart: always
    container_name: petapi-app-queue
    working_dir: /var/www/
    image: petapii
    depends_on:
      - &amp;quot;app&amp;quot;
    command: bash -c &amp;quot;php artisan queue:work --sleep=3 --tries=3 &amp;amp;&amp;amp; composer dumpautoload&amp;quot;
    volumes:
      - ./:/var/www
    networks:
      - petapin
  frontapp:
    build:
      context: ~/petclient/dockerfiles/node/
      dockerfile:  Dockerfile
    image: frontapp
    container_name: petclient-frontapp
    restart: unless-stopped
    networks:
      - petclientn
  db:
    image: mysql:5.7
    container_name: petapi-db
    restart: unless-stopped
   #env_file:
     # - ~/petapi/pets-api/.env
    environment:
      MYSQL_DATABASE: ${DB_DATABASE}
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
      MYSQL_PASSWORD: ${DB_PASSWORD}
      MYSQL_USER: ${DB_USERNAME}
      SERVICE_TAGS: dev
      SERVICE_NAME: mysql
    volumes:
      - ./docker-compose/mysql:/docker-entrypoint-initdb.d
      - ./docker-compose/mysql/data:/var/lib/mysql
    networks:
      - petapin
  nginx:
   # build:
    # context: ./dockerfiles/nginx/
   #  dockerfile: Dockerfile
  #  image: nginx:1.19.1-alpine-custom
    image: nginx:1.19.1-alpine
    container_name: pet-nginx
    restart: always
    depends_on:
      - app
      - frontapp
    ports:
      - 80:80
      - 443:443
    volumes:
      - ./:/var/www
      - ./docker-compose/nginx:/etc/nginx/conf.d
      - ./docker-compose/nginx/certs:/etc/nginx/certs
    networks:
      - petapin
      - petclientn
networks:
  petapin:
    driver: bridge
  petclientn:
    driver: bridge


                                        </div>
                                        
                                            <a class="btn btn-text" href="https://dzkjz.github.io/post/laravel-shi-yong-sendgrid-de-pei-zhi/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://dzkjz.github.io/post/mysql-docker-rong-qi-guan-yu-ru-he-chu-li-down-hou-up-shu-ju-jiu-diu-shi-de-wen-ti-yi-ji-yuan-li/">
                        Mysql Docker容器关于如何处理down后up数据就丢失的问题以及原理
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-07-27</time>
                    
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            Mysql Docker容器关于如何处理down后up数据就丢失的问题以及原理
[toc]
docker-compose 可以很方便的用于部署多容器环境。其中比较繁琐的就是做到多应用间数据分离。
容器随时我们可以关闭更新更换，但是要怎么做到数据的连续性就很关键了。
一、场景介绍
比较常见的情况，如果你运行起一个数据库容器，如果你删除了这个容器，那存在其中的数据也就丢失了。
特别是执行docker-compose down然后更新dockerfile和docker-compose.yml文件，再执行docker-compose up -d，你之前网站的数据就丢了。
二、原理以及原因

我们在有运行数据库容器的机器里面演示；

执行docker volume ls查看服务器里面的数据卷：

默认driver就是local ，我们配置的数据卷都在这里面了。
为了查看哪一个是数据库容器的数据卷，以及对应的详细信息
执行docker inspect 数据库容器名
然后找到 Mounts部分：

第一个我们配置的可以在docker-compose.prod.yml中找到：
  db:
    image: mysql:5.7
    container_name: ***api-db
    restart: unless-stopped
    environment:
      MYSQL_DATABASE: ${DB_DATABASE}
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
      MYSQL_PASSWORD: ${DB_PASSWORD}
      MYSQL_USER: ${DB_USERNAME}
      SERVICE_TAGS: dev
      SERVICE_NAME: mysql
    volumes:
      - ./docker-compose/mysql:/docker-entrypoint-initdb.d

而第二个对应目标地址是/var/lib/mysql的，因为我没有配置，所以自动给了一个，正是这个没有配置，导致每次docker-compose up -d就生成一个新容器及对应的数据卷，然后之前的数据库数据就丢失了。
三、处理办法
如果你配置了比如
  db:
    ...
    volumes:
      - ./docker-compose/mysql:/docker-entrypoint-initdb.d
      - /data/mysql:/var/lib/mysql
   #   - /data/pgsql:/var/lib/postgresql
   #   - /data/maria:/var/lib/mariadb
   #   - /data/redis:/var/lib/redis
   #   - /data/memcached:/var/lib/memcached
   #   - /data/neo4j:/var/lib/neo4j/data
    networks:
      ...

配置了对应的本地[宿主机]数据卷位置，第一次docker-compose up -d的时候会直接关联起来，而下一次执行docker-compose up -d的时候，daemon执行到生成一个对应数据卷位置的时候，发现已经给了配置，那就跳过，使用先前的。
当然也可以这么配置：
volumes:
- db-data:/var/lib/mysql
volumes:
 db-data:
  driver: local


参考 Running PostgreSQL using Docker Compose
参考 Data is lost in Mysql docker container after comminting it to a new image?

I don&#39;t know which image you&#39;re using but I believe every Dockerfile of official mysql images has following command:
VOLUME /var/lib/mysql

which means all mysql data goes to volume. From docker volume docs they specially mentioned that:
&amp;gt; Changes to a data volume will not be included when you update an image.

And this is the root cause you loss your data in newly started container.
For your question:

How to achieve this?

You can use either mounted volumes, or create a data volume container, then run mysql container with option --volumes-from. The former links contain step-by-step guide of how to do it.

I don&#39;t want to use mounted volumes because i want to link this container with another container of my application so that it can inset and update into db

I don&#39;t know what other concerns you have about mounted volumes, but as far as I can tell, using mounted volumes does not prevent you to link containers.
Hope this helps you.


四、如果不慎丢失，怎么恢复
如果数据卷都删除了 docker rm 容器的时候 添加了 -v 或 -volume，那就拜拜，没有任何办法的。如果没有删除volume 参考：
Saving &#39;lost&#39; MYSQL database running in Docker
更多可以看官方文档

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://dzkjz.github.io/post/mysql-docker-rong-qi-guan-yu-ru-he-chu-li-down-hou-up-shu-ju-jiu-diu-shi-de-wen-ti-yi-ji-yuan-li/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://dzkjz.github.io/post/jie-jue-sitemap-robotstxt-yi-ji-ti-jiao-google-index/">
                         解决 sitemap robots.txt 以及提交google index
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-07-26</time>
                    
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            Sitemap
在nuxt app里面执行
npm install @nuxtjs/sitemap

//nuxt.config.js
  modules: [
    // Doc: https://axios.nuxtjs.org/usage
    &#39;@nuxtjs/axios&#39;,
    &#39;@nuxtjs/auth&#39;,
    &#39;vue-social-sharing/nuxt&#39;,
    // Doc: https://github.com/nuxt-community/dotenv-module
    &#39;@nuxtjs/dotenv&#39;,
    &#39;cookie-universal-nuxt&#39;,//https://www.npmjs.com/package/cookie-universal-nuxt
    &#39;@nuxtjs/sitemap&#39;,
  ],

  sitemap: {
    //https://www.npmjs.com/package/@nuxtjs/sitemap
    hostname: &#39;https://&#39; + process.env.DOMAIN_NAME,
    gzip: true,
    exclude: [
      &#39;/verify/**&#39;,
      &#39;/verifynew/**&#39;,
      &#39;/password_reset/**&#39;,
      &#39;/dashboard_reset/**&#39;,
      &#39;/animals/create/**&#39;,
    ],

具体配置官方文档有讲。
默认情况下只有static页面会自动添加，对于动态的路由页面，parent/:children，这样的，参考 HOW TO: Include dynamic routes in sitemap with Nuxt.js
Robot.txt
npm install @nuxtjs/robots
//nuxt.config.js
  modules: [
    // Doc: https://axios.nuxtjs.org/usage
    &#39;@nuxtjs/axios&#39;,
    &#39;@nuxtjs/auth&#39;,
    &#39;vue-social-sharing/nuxt&#39;,
    // Doc: https://github.com/nuxt-community/dotenv-module
    &#39;@nuxtjs/dotenv&#39;,
    &#39;cookie-universal-nuxt&#39;,//https://www.npmjs.com/package/cookie-universal-nuxt
    &#39;@nuxtjs/sitemap&#39;,
    &#39;@nuxtjs/robots&#39;,
  ],
        robots: [ //https://www.npmjs.com/package/@nuxtjs/robots
    {
      // UserAgent: &#39;Googlebot&#39;,
      UserAgent: &#39;*&#39;,
      Disallow: () =&amp;gt; [
        &#39;/verify&#39;,
        &#39;/verify&#39;,
        &#39;/verifynew&#39;,
        &#39;/password_reset&#39;,
        &#39;/dashboard_reset&#39;,
        &#39;/animals/create&#39;,
      ], // accepts function
      Sitemap: &#39;https://&#39; + process.env.DOMAIN_NAME + &#39;/sitemap.xml&#39;,
    }
  ],

具体配置介绍参考官方文档。
Ask Google to recrawl your URLs
Submit a sitemap (many URLs at once)
A sitemap is an important way for Google to discover URLs on your site. A sitemap can also include additional metadata about alternate language versions and video-, image-, or news-specific pages. Learn how to create a sitemap.
If you have not changed your sitemap since the last time Google crawled it, resubmitting the sitemap won&#39;t have any additional benefit. If you have updated pages in the sitemap, mark them with &amp;lt;lastmod&amp;gt;.
Here are the different ways that you can alert Google about your sitemap:

Submit a sitemap using the sitemaps report.
Use the ping tool. Send a GET request in your browser or the command line to this address, specifying the full URL of the sitemap. Be sure that the sitemap file is accessible:
http://www.google.com/ping?sitemap=*&amp;lt;full_URL_of_sitemap&amp;gt;*
Example:
http://www.google.com/ping?sitemap=https://example.com/sitemap.xml
Insert the following line anywhere in your robots.txt file, specifying the path to your sitemap. We will find it the next time we crawl your site:
Sitemap: http://example.com/my_sitemap.xml

Nuxt页面跳转过度动效
/*assets/styles/main.css*/
/*@import &#39;@vue-cookie-accept-decline.css&#39;;*/

.page-enter-active, .page-leave-active {
  transition: opacity .5s;
}

.page-enter, .page-leave-to {
  opacity: 0;
}

//nuxt.config.js 
css: [
      ...
    &#39;@/assets/styles/main.css&#39;,
      ...
  ],

官方文档：
https://nuxtjs.org/api/configuration-loading
https://nuxtjs.org/api/pages-transition
//nuxt.config.js
loading: {
    color: &#39;orange&#39;,
    height: &#39;5px&#39;,
    failedColor: &#39;red&#39;,
    duration: 5000,
    continuous: true,
  },

自定义的可以参考 使用自定义的组件设置加载样式
改变Favicon
参考 https://github.com/nuxt/nuxt.js/issues/903
//nuxt.config.js
link: [
      {rel: &#39;icon&#39;, type: &#39;image/x-icon&#39;, href: &#39;/tiere_favi.png&#39;},
    ]

官方文档也可以看看

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://dzkjz.github.io/post/jie-jue-sitemap-robotstxt-yi-ji-ti-jiao-google-index/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://dzkjz.github.io/post/cai-keng-ji-lu-nuxtjs-and-ant-design-vue-pei-zhi/">
                        「踩坑记录」 Nuxt.js &amp; Ant-design-vue 配置
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-07-25</time>
                    
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            Nuxt.js &amp;amp; ant-design-vue
最近开发一个带seo以及部分后台功能的项目，nuxt作为vue ssr框架可以非常好的完成这个需求，这里我选择了ant-design-vue作为UI组件库。
以下是踩坑的一些记录 ：
首先介绍一下项目情况和需求：

Nuxt.js是一个 Vue.js 通用框架，预设了使用 Vue.js开发SSR的各种配置。项目中使用的是SSR模式，因此首屏是由服务端完成渲染。
项目仅用到少数的UI组件，因此我们希望使用按需加载组件，以减少网络开销。

1. 按需加载引入组件
首先我们移除掉 nuxt.config.js 中
{   css: [&#39;ant-design-vue/dist/antd.css&#39;],   // 这里会全局引入所有样式，不是我们所希望的按需加载 }

参考官方文档antd-vue # 按需加载：
// 同时参考 Nuxt-cli 创建项目时 创建的 plugin/antd-ui.js 
import Vue from &#39;vue&#39; import Button from &#39;ant-design-vue/lib/button&#39;; 
import &#39;ant-design-vue/lib/button/style&#39;; // 或者 ant-design-vue/lib/button/style/css 加载 css 文件  
Vue.use(Button.name, Button)

编译未通过，提示错误：
// https://github.com/ant-design/ant-motion/issues/44 .bezierEasingMixin(); ^ Inline JavaScript is not enabled. Is it set in your options?

根据报错所提供的信息，less升级到3.0 后，需要 less-loader配置一个功能，才能正常使用：
// nuxt.config.js 
{  
    build: {   
        loaders: {    
            less: {     
                javascriptEnabled: true    
            }   
        }  
    } 
}

编译通过，打开页面，返回500，提示：

image.png
编译能通过，说明代码编译没有问题，但是server端执行时出现了错误。尝试注释掉plugin/antd-ui.js引入样式文件这行 import &#39;ant-design-vue/lib/button/style&#39;; ，server首屏渲染能够正常启动，但引入的button组件样式丢失。
打开 ant-design-vue/lib/button/style/index.js 查看：
&#39;use strict&#39;; 
require(&#39;../../style/index.less&#39;); 
require(&#39;./index.less&#39;);  
// ant-design-vue/es/button/style/index.js 
import &#39;../../style/index.less&#39;; 
import &#39;./index.less&#39;;

可以看到，antd-vue为生产环境提供了两种模块的代码。为了tree-shaking 我们优先选择 es 模块。

补充知识：现在的webpack@4+ 支持识别项目 packge.json module字段，使用ESModule的依赖更好的支持构建中的tree-shaking。

修改代码为 es/button/...，编译通过，但页面仍抛出一500服务端错误：

image.png
根据错误提示cannot use import statement和es包使用的ESModule语法，猜测服务端侧渲染页面时语法出错，Node.js 不能直接识别 .js文件内的ESModule语法。
// .nuxt.config.js 
{  
    plugins: 
    [   
        {    
            src: &#39;@/plugins/antd-ui&#39;,    
            mode: &#39;client&#39; // 仅 客户端使用plugin   
        }  
    ] 
}

页面正常加载，但Vue.js 给出了错误提示

image.png
此时，我们再将plugin代码替换回lib以及移除mode: &#39;client ，错误又回到了最开始的 invalid or unexpected token。
搜索Nuxt官方文档：

如果要使用Babel与特定的依赖关系进行转换，你可以在build.transpile中添加它们，transpile中的选项可以是字符串或正则表达式对象，用于匹配依赖项文件名。

添加配置：
{ // nuxt.config.js  
    build: {   
        transpile: [/ant-design-vue/]
    } 
}

终于，服务端渲染正常，样式也正常加载。接着引入 ant-design-vue官方推荐使用的插件babel-plugin-import
// nuxt.config.js 
{  
    build: {
        babel: {
            plugins: [
                [      
                    &#39;import&#39;,      
                    {       
                        libraryName: &#39;ant-design-vue&#39;,       
                        libraryDirectory: &#39;es&#39;,       
                        // 选择子目录 例如 es 表示 ant-design-vue/es/component       
                        // lib 表示 ant-design-vue/lib/component              
                        style: true       
                        // 默认不使用该选项，即不导入样式 , 注意 ant-design-vue 使用 js 文件引入样式       
                        // true 表示 import  &#39;ant-design-vue/es/component/style&#39;      
                        // &#39;css&#39; 表示 import &#39;ant-design-vue/es/component/style/css&#39;      
                    }     
                ]    
            ]   
        }  
    } 
}  // plugins/antd-ui.js 
import Vue from &#39;vue&#39; 
import { Button } from &#39;ant-dsign-vue&#39; // 这时，可以通过 简写的方式引入样式和组件  
Vue.use(Button)

2. pages目录内引入组件

flash.gif
上图是在pages/index.vue内引入组件，npm run build &amp;amp;&amp;amp; npm run start 执行后的线上环境，可以看到样式在刷新首屏时，会看到闪烁的现象，这里出现的问题在于入口文件并不包含组件，而是异步引入的，从编译结果上也可以看到 610kb 的包对应的chunk vendors.pages/index ，并不在entrypoint内，默认情况下Nuxt.js 路由页面已经被分配为dynamic import，同时style是通过js设置到style上的，而不是单独打包出来。经过测试，css单独打包后，UI组件仍是单独分包，即便是单独打包出来，依然会有按需加载的问题，首屏仍会闪烁。

build result
因此，如果组件被大多数页面使用，推荐在 plugin内注册，或者通过 nuxt.config.js的css相关文件直接引入对应的组件样式，同时关闭babel-import-plugin 的 style选项。 (吐槽一句，iView只能引入单一全局样式，不能按需加载样式，1.5m的大小非常恐怖)
除此以外，可以考虑配置webpack的splitchunks配置，实现自己的需求。
3. 解决antd-icon 过大（传统艺能
前面生产环境的包可以发现，只使用了一个Button，却打包了600kb的依赖，检查后发现是引入了@ant-design/icon 包。
参考： https://github.com/HeskeyBaozi/reduce-antd-icons-bundle-demo
{ // nuxt.config.js  
    build: 
    {   
        extend(config, ctx) {
            config.resolve.alias[&#39;@ant-design/icons/lib/dist$&#39;] = path.resolve(__dirname, &#39;./assets/icon/antd-icon.js&#39;) // 引入需要的  
        }  
    } 
}

题外话
“按需引入”

image.png
https://github.com/ant-design/babel-plugin-import/issues/347
reference
https://github.com/vueComponent/ant-design-vue/issues/234
https://www.zhihu.com/question/265227812

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://dzkjz.github.io/post/cai-keng-ji-lu-nuxtjs-and-ant-design-vue-pei-zhi/">Read More ~</a>
                            </div>
                </div>
            </article>
            
                <!-- 翻页 -->
                
    <div class="pagination-container">
        
                
                    <a href="https://dzkjz.github.io/page/2" class="page-btn btn">下一页</a>
                    
    </div>
    
                </div>
                <!--  -->
                <div class="main-container-middle"></div>
                <!--  -->
                <div id="sidebar" class="main-container-right">

                    <!-- 个人信息 -->
                    
    <div class="id_card i-card">
        <div class="id_card-avatar" style="background-image: url(https://dzkjz.github.io//images/avatar.png?v=1596552801325)">
        </div>
        <h1 class="id_card-title">
            JojoLegend
        </h1>
        <h2 class="id_card-description">
            Something for age
        </h2>
        <!--  -->
        <div class="id_card-sns">
            <!-- github -->
            
                    <!-- twitter -->
                    
                            <!-- weibo -->
                            
                                    <!-- facebook -->
                                    

        </div>
    </div>
    

                        <!-- 公告栏 -->
                        

                </div>
            </div>



            <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://dzkjz.github.io//atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
    <script>
        $('#sidebar').stickySidebar({
            topSpacing: 80,
            // bottomSpacing: 60
        });
    </script>
</body>

</html>